# 專業報告功能升級說明

## 📋 更新概要

參考「桶.pdf」(臺北市政府警察局統計室《臺北市高齡駕駛交通事故特性分析》)的專業統計報告格式,為國發基金問卷分析系統新增**政府統計報告格式**。

---

## 🎯 新增功能

### 1. **雙報告格式選擇**
- ✅ **政府統計報告格式**（新增）：參考官方統計報告結構
- ✅ **標準業務報告**（原有）：執行摘要式報告

### 2. **政府統計報告特色**

#### 📑 報告結構（參考 PDF）
```
封面資訊
  ↓
摘要（背景、目的、主要發現）
  ↓
目次
  ↓
表目次 / 圖目次
  ↓
壹、前言（研究背景與目的）
  ↓
貳、問卷資料概況
    一、填答者分佈
    二、階段分佈
    三、資料完整度
  ↓
參、主要議題分析
    一、高度顯著議題
    二、重要關注議題
  ↓
肆、統計檢定分析
    一、公司方與投資方差異檢定
    二、階段間差異檢定（ANOVA）
  ↓
伍、結語（總結與政策建議）
  ↓
陸、附錄
    - 完整議題清單
    - 統計方法說明
```

#### 📊 統計方法說明

參考 PDF 第 10-17 頁的檢定方式:

1. **t 檢定**
   - 用於：性別間差異檢定
   - 假設：H₀: μ_male = μ_female
   - 顯著水準：α = 0.05

2. **ANOVA（變異數分析）**
   - 用於：多組比較（年齡組、階段、車種等）
   - 假設：H₀: μ₁ = μ₂ = μ₃ = ...
   - F 統計量：組間變異 / 組內變異

3. **Tukey's HSD 事後檢定**
   - 用於：ANOVA 顯著後,找出哪兩組有差異
   - 計算：HSD = q(α, k, df) × √(MSE/n)
   - 判斷：若 |μᵢ - μⱼ| ≥ HSD,則該兩組有顯著差異

4. **卡方檢定 / Fisher 精確檢定**
   - 用於：類別變項分佈差異
   - χ² = Σ [(觀察值 - 期望值)² / 期望值]

#### 📈 專業表格格式

```markdown
| 序號 | 議題名稱 | 樣本數 | 優先順序 | 統計顯著性 |
|------|---------|--------|----------|-----------|
| 1    | XXX議題 | 500    | 4.5      | ⭐⭐⭐      |
```

**顯著性標記：**
- ⭐⭐⭐：p < 0.001（極顯著）
- ⭐⭐：p < 0.01（高度顯著）
- ⭐：p < 0.05（顯著）

#### 💼 業務語言轉譯

| 統計術語 | 業務語言 |
|---------|---------|
| p < 0.001 | 存在極顯著差異,建議深入探討造成差異的結構性因素 |
| p < 0.01 | 呈現高度顯著差異,值得納入輔導計畫重點項目 |
| p < 0.05 | 存在可觀察的差異,建議持續關注 |
| 中位數差異 | 實務做法的落差 |
| 分佈不均 | 雙方認知存在系統性差異 |

---

## 🔧 技術實現

### 新增檔案

#### `professional_report_enhanced.py`
- 功能：政府統計報告格式生成器
- 主要函式：
  - `generate_government_style_report()`: 產生完整政府格式報告
  - `add_chart_index_to_report()`: 產生圖表目次

### 修改檔案

#### `cloud_app.py`
- 第 11 行：新增 import
  ```python
  from professional_report_enhanced import generate_government_style_report
  ```

- 第 2002-2048 行：報告生成介面
  ```python
  # 雙按鈕設計
  - "生成完整分析報告（新格式）"：政府統計報告
  - "生成標準報告（原格式）"：原有業務報告
  ```

---

## 📦 相關檔案

### 1. `analyze_pdf.py`
- 功能：PDF 文字提取與分析工具
- 套件：`pdfplumber`
- 用途：分析「桶.pdf」結構與內容

### 2. `桶.pdf`
- 來源：臺北市政府警察局統計室
- 標題：臺北市高齡駕駛交通事故特性分析
- 日期：114 年 10 月
- 總頁數：27 頁
- 參考內容：
  - 報告結構（封面、摘要、目次、正文、結語）
  - 統計檢定方法（t 檢定、ANOVA、Tukey's HSD）
  - 表格與圖表格式
  - 專業術語使用

---

## 🚀 使用方式

### 1. 啟動系統
```bash
streamlit run cloud_app.py
```

### 2. 上傳問卷資料
- 支援 CSV 格式
- 需包含 `respondent_type`（公司方/投資方）
- 可選 `phase`（階段）欄位

### 3. 選擇分析模式
- 深度分析
- 公司方與投資方比較
- 階段比較

### 4. 生成報告
- 點擊「生成完整分析報告（新格式）」→ 政府統計報告
- 點擊「生成標準報告（原格式）」→ 業務報告

### 5. 下載報告
- Markdown 格式
- 檔名格式：`統計應用分析報告_未上市櫃公司治理_YYYYMMDD_HHMMSS.md`

---

## 📊 報告範例片段

```markdown
# 統計應用分析報告

## 未上市櫃公司治理問卷
## 深度統計分析

---

**國家發展基金管理會**

**報告編撰日期：** 2025 年 11 月 12 日

---

## 摘要

隨著我國資本市場發展，未上市櫃公司的公司治理日益受到重視。
本研究運用公司治理問卷資料，就 500 筆填答資料進行全面性統計分析...

## 壹、前言

### 研究背景
公司治理為現代企業經營的核心議題...

### 研究目的
1. **公司方與投資方的認知差異**
2. **不同階段公司的治理特性**
3. **關鍵治理議題識別**
4. **政策建議**

## 貳、問卷資料概況

### 一、填答者分佈

| 填答者類型 | 筆數 | 佔比 |
|----------|------|------|
| 公司方   | 350  | 70.0% |
| 投資方   | 150  | 30.0% |

...
```

---

## 🎓 參考文獻

1. 臺北市政府警察局統計室,《臺北市高齡駕駛交通事故特性分析》, 114 年 10 月
2. 原有系統功能：`generate_professional_report()` 函式

---

## 💡 未來改進方向

1. ✅ 智慧排序（已完成）
   - 百分比範圍（10-20%, 20-30%）
   - 中文程度詞（非常不同意 → 非常同意）

2. ✅ 政府統計報告格式（已完成）
   - ANOVA 檢定
   - Tukey's HSD 事後檢定
   - 表目次 / 圖目次

3. ⏳ 待實現功能
   - 自動化 ANOVA 計算與 Tukey's HSD 配對比較
   - 圖表嵌入報告（目前僅有文字敘述）
   - PDF 輸出（目前僅 Markdown）
   - 標準化指標計算（每百人比率等）

---

## 📞 技術支援

- 報告功能模組：`professional_report_enhanced.py`
- PDF 分析工具：`analyze_pdf.py`
- 主系統：`cloud_app.py`

**最後更新：** 2025 年 11 月 12 日
